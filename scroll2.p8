pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- goal: 6 minutes (360s)
--       4 minutes (240s)

--   done: add the plane
--   done: sideways scroll
--   done: boss landscape repetion

butarr={1,2,0,3,5,6,3,4,8,7,4,0,1,2,0}

dirx={-1,1, 0,0, -0.7, 0.7,0.7,-0.7}
diry={ 0,0,-1,1, -0.7,-0.7,0.7,0.7}

butarr[0]=0

shiparr={65,67,69,71,73}

shipspr=0

shots={}
shotwait=0

wep=2

muzz={}


function _init()
 px,py=64,64
 spd=1.4
 lastdir=0
 t=0

 scroll=0
 xscroll=0
  
 boss=false
 
 mapsegs={1,2,1,8,27,2,1,8,27,2,1,8,27,2,1,8,27,2,1,8,27,2,1,8,27,2,1,8}
 mapsegi=0
 cursegs={}
end

function _draw()
 cls(2)
 for seg in all(cursegs) do
  map(seg.x,seg.y,xscroll,scroll-seg.o,18,8)
 end
 
 for s in all(shots) do    
  spr(s.sani[flr(s.si)],s.x,s.y,1,s.sh)
 end
 
 for m in all(muzz) do    
  spr(m.sani[flr(m.si)],px+m.x,py+m.y,2,2)
 end
 
 --ship
 spr(shiparr[flr(shipspr*2.4+3.5)],px,py,2,2)
 local flamearr={76,77,78,77}
 local fframe=flamearr[t\3%4+1]
 spr(fframe,px+6,py+15)
 spr(fframe,px+3,py+15)
 
 print(#cursegs,5,5,7)
 print(scroll,5,11,7)
 print(xscroll,5,17,7)
 print(boss and "boss" or "noboss",5,23,7)
end

function _update60()
 --scrolling
 scroll+=0.2
 
 if #cursegs<1 or scroll-cursegs[#cursegs].o>0 then
  if boss then
   scroll-=64
   for seg in all(cursegs) do
    seg.o-=64
   end
  else
   mapsegi+=1  
  end
  
  local segnum=mapsegs[mapsegi]

  add(cursegs,{
   x=segnum\4*18,
   y=segnum%4*8,
   o=#cursegs<1 and -64 or cursegs[#cursegs].o+64
  })
  
  --★
  if scroll-cursegs[1].o>=128 then
   deli(cursegs,1)
  end
 
 end
 
 --movement
 t+=1
 local dir=butarr[btn()&0b1111]
 
 if lastdir!=dir and dir>=5 then
  --anti-cobblestone
  px=flr(px)+0.5
  py=flr(py)+0.5
 end
 
 local dshipspr=0
 
 if dir>0 then
  px+=dirx[dir]*spd
  py+=diry[dir]*spd
  dshipspr=mysgn(dirx[dir])
 end
  
 shipspr+=mysgn(dshipspr-shipspr)*0.15
 shipspr=mid(-1,shipspr,1)
 
 lastdir=dir
 
 xscroll=mid(0,(px-10)/100,1)*-16
 
 
 if shotwait>0 then
  shotwait-=1
 end
 
 if btn(❎) then
  if wep==1 then
   shot_raiden()
  elseif wep==2 then
   shot_ddp()
  end
 
 end
 
 boss=btn(🅾️)
 
 doshots()
 domuzz()
 
end
-->8
--move and shoot

function doshots()
 for s in all(shots) do
  s.x+=s.sx
  s.y+=s.sy
  s.si+=0.5
  
  if flr(s.si)>#s.sani then
   s.si=1
  end
  
  if s.y<-16 then
   del(shots,s)
  end
 end
end

function domuzz()
 for m in all(muzz) do
  m.si+=1 
  if flr(m.si)>#m.sani then
   del(muzz,m)
  end
 end
end

function mysgn(v) 
 return v==0 and 0 or sgn(v)
end

function shot_raiden()
 if shotwait<=0 and #shots<6 then
  local shotspd=-3.5
  shotwait=4
  
  add(shots,{
   x=px+3,
   y=py,
   sx=0,
   sy=shotspd,
   sani={75},
   si=1,
   sh=1
  })
  add(shots,{
   x=px+9,
   y=py,
   sx=0,
   sy=shotspd,
   sani={75},
   si=1,
   sh=1
  })
  
  add(muzz,{
   x=-4,
   y=-8,
   sani={99,101,103,105},
   si=0,
  })
  add(muzz,{
   x=4,
   y=-8,
   sani={99,101,103,105},
   si=0,
  })
  
  sfx(0)
 end
end

function shot_ddp()
 if shotwait<=0 and #shots<100 then
  local shotspd=-6
  shotwait=3
  
  add(shots,{
   x=px,
   y=py-5,
   sx=0,
   sy=shotspd,
   sani={96,97,98},
   si=(t\2)%3+1,
   sh=2
  })
  add(shots,{
   x=px+8,
   y=py-5,
   sx=0,
   sy=shotspd,
   sani={96,97,98},
   si=(t\2)%3+1,
   sh=2
  })
  
  add(muzz,{
   x=-4,
   y=-8,
   sani={99,101,103,105},
   si=0,
  })
  add(muzz,{
   x=4,
   y=-8,
   sani={99,101,103,105},
   si=0,
  })
  sfx(0)
 end
end
__gfx__
000000006ddddddddddddddddddddddd911991190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddddddddddddddddd666666d119911990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700dddddddd66666666d6dddd5d199119910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000dddddddd66666666d6dddd5d991199110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000dddddddd66666666d6dddd5d911991190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700dddddddd66666666d6dddd5d119911990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddddddddddddddddd655555d199119910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddddddddddd991199110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006ddddddd6ddddddd6ddddddd6ddddddd6ddddddd6ddddddd6ddddddd6ddddddd6ddddddd6ddddddd0000000000000000000000000000000000000000
00000000dd66dddddd666ddddd666ddddd6d6ddddd666ddddd6ddddddd666ddddd666ddddd666ddddd666ddd0000000000000000000000000000000000000000
00000000ddd6dddddddd6ddddddd6ddddd6d6ddddd6ddddddd6ddddddddd6ddddd6d6ddddd6d6ddddd6d6ddd0000000000000000000000000000000000000000
00000000ddd6dddddd666dddddd66ddddd666ddddd666ddddd666ddddddd6ddddd666ddddd666ddddd6d6ddd0000000000000000000000000000000000000000
00000000ddd6dddddd6ddddddddd6ddddddd6ddddddd6ddddd6d6ddddddd6ddddd6d6ddddddd6ddddd6d6ddd0000000000000000000000000000000000000000
00000000dd666ddddd666ddddd666ddddddd6ddddd666ddddd666ddddddd6ddddd666ddddd666ddddd666ddd0000000000000000000000000000000000000000
00000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd0000000000000000000000000000000000000000
00000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd0000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000011000000000000001100000000000000110000000000000011000000000000001100000000990000000070000000700000007000000000000
00000000000000167100000000000016710000000000001661000000000000167100000000000016710000009779000000777000007770000077700000000000
00700700000000111d100000000000111d1000000000011111100000000001d111000000000001d11100000097790000007c7000007c70000077700000000000
00077000000001ccc1100000000001ccc1100000000001cccc1000000000011ccc1000000000011ccc1000009aa9000000070000007c7000007c700000000000
0007700000001c77cc11000000001c77cc11000000001c77ccc10000000011c77cc10000000011c77cc100009aa900000000000000070000007c700000000000
0070070000001c7c1c11000000001c7c1c11000000001c7cc1c10000000011c7c1c10000000011c7c1c100000990000000070000000000000007000000000000
0000000000001c111c11100000011c111c11100000111c1111c11100000111c111c11000000111c111c100000000000000000000000700000007000000000000
0000000000001c111c17100000011c111c17100000171c1111c17100000171c111c11000000171c111c100000000000000000000000000000007000000000000
0000000000011cc17116100000161cc1171610000016117117116100000161711cc16100000161171cc110000000000000000000000000000000000000000000
000000000001d1c711d6d1000016d1c77116d10001d6d117711d6d10001d61177c1d6100001d6d117c1d10000000000000000000000000000000000000000000
00000000001ddd111d6d7d1001dddd1111dd6710176d6d1111d6d6710176dd1111dddd1001d7d6d111ddd1000000000000000000000000000000000000000000
00000000001dd6ddd6d66d1001dd66dddd6d66101666d6dddd6d66610166d6dddd66dd1001d66d6ddd6dd1000000000000000000000000000000000000000000
00000000001d676676d6dd1001d6676676d6dd101dd6d676676d6dd101dd6d6766766d1001dd6d676676d1000000000000000000000000000000000000000000
00000000000176d167d1110000117dd1171111000111171661711110001111711dd7110000111d761d6710000000000000000000000000000000000000000000
000000000000151155d110000001655155d11000000161511516100000011d551556100000011d55115100000000000000000000000000000000000000000000
00000000000001111111000000001111111100000000111111110000000011111111000000001111111000000000000000000000000000000000000000000000
00099000000990000009900000000000000000000000000770000000000000000000000000007000000700000000000000000000000000000000000000000000
00099000000990000009900000000000000000000000000770000000000070000007000000000000000000000000000000000000000000000000000000000000
00977900000990000009900000000000000000000000000770000000000070000007000000000000000000000000000000000000000000000000000000000000
00977900009aa9000009900000000000000000000000700770070000000000000000000000000000000000000000000000000000000000000000000000000000
09777790009779000009900000000007700000000007707777077000000000077000000000000000000000000000000000000000000000000000000000000000
0977779000977900009aa90000000777777000000007707777077000000000077000000070000000000000070000000000000000000000000000000000000000
97a77a7909a77a900097790000007777777700000000777777770000070000077000007000000000000000000000000000000000000000000000000000000000
97a77a7909a77a900097790000007777777700000070777777770700007000777700070000000000000000000000000000000000000000000000000000000000
9aa77aa909a77a90009aa90000077777777770000077777777777700000007777770000000000000000000000000000000000000000000000000000000000000
9aa77aa9099aa990009aa90000077777777770000007777777777000000007777770000007000007700000700000000000000000000000000000000000000000
9a9aa9a9099aa990009aa90000077777777770000000777777770000007007777770070000000007700000000000000000000000000000000000000000000000
999aa999099999900099990000007777777700000000777777770000000007777770000000000077770000000000000000000000000000000000000000000000
999aa999099999900099990000000777777000000000077777700000000000777700000000000077770000000000000000000000000000000000000000000000
90999909099999900099990000000077770000000000007777000000000000077000000000000007700000000000000000000000000000000000000000000000
90099009090990900009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000080880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
04011a0101010101010101010101010101040401140101010101010101010101010101040401180101010101010101010101010101040401111201010101010101010101010101040401111601010101010101010101010101040401121a01010101010101010101010101040401121401010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040000
0401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040401030301010101010101010303010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401110101010101010101010101010101040401150101010101010101010101010101040401190101010101010101010101010101040401111301010101010101010101010101040401111701010101010101010101010101040401121101010101010101010101010101040401121501010101010101010101010101040000
0401010101010101010101010301010101040401010101010101010101010301010101040401010101010101010101010301010101040401010101010101010101010301010101040401010101010101010101010301010101040401010101010101010101010301010101040401010101010101010101010301010101040000
0402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040000
0401010103010101010301010101010101040401010103010101010301010101010101040401010103010101010301010101010101040401010103010101010301010101010101040401010103010101010301010101010101040401010103010101010301010101010101040401010103010101010301010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401120101010301010101010101010101040401160101010301010101010101010101040401111a01010301010101010101010101040401111401010301010101010101010101040401111801010301010101010101010101040401121201010301010101010101010101040401121601010301010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040402020202020202020202020202020202040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
0401010101010301010101010101010101040401010101010301010101010101010101040401010101010301010101010101010101040401010101010301010101010101010101040401010101010301010101010101010101040401010101010301010101010101010101040401010101010301010101010101010101040000
0401010101010101010101010303010101040401010101010101010101010303010101040401010101010101010101010303010101040401010101010101010101010303010101040401010101010101010101010303010101040401010101010101010101010303010101040401010101010101010101010303010101040000
0401130101010103030101010303010101040401170101010103030101010303010101040401111101010103030101010303010101040401111501010103030101010303010101040401111901010103030101010303010101040401121301010103030101010303010101040401121701010103030101010303010101040000
0401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040401010101010101010101010101010101040000
__sfx__
a2010000070401f6401f6300e6200d610050100301001050000100201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
