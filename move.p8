pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- t: make basic movement feel nice
--    ❎: fixed cobblestoning
--    ❎: what is a good movement speed
--    t: do banking

-- t: make shooting feel nice!

-- x: normalized diagonals

butarr={1,2,0,3,5,6,3,4,8,7,4,0,1,2,0}

dirx={-1,1, 0,0, -0.7, 0.7,0.7,-0.7}
diry={ 0,0,-1,1, -0.7,-0.7,0.7,0.7}

butarr[0]=0

shiparr={1,3,5,7,9}

shipspr=0

shots={}
shotwait=0

wep=2

function _init()
 px,py=64,64
 spd=1.4
 lastdir=0
 
 cls(0)
 t=0
end

function _draw()
 cls(12)
  
 spr(shiparr[flr(shipspr*2.4+3.5)],px,py,2,2)
 --pset(px,py,8)
 
 local flamearr={12,13,14,13}
 local fframe=flamearr[t\3%4+1]
 spr(fframe,px+6,py+15)
 spr(fframe,px+3,py+15)
 
 for s in all(shots) do
  spr(s.s,s.x,s.y,1,s.sh)
 end
 
 local btnv=btn()&0b1111
 print(t,5,5,7)
 print(shotwait,5,11,7)
 print("shots:"..#shots,5,17,7)
 print("",5,23,7)
end

function _update60()
 t+=1
 local dir=butarr[btn()&0b1111]
 
 if lastdir!=dir and dir>=5 then
  --anti-cobblestone
  px=flr(px)+0.5
  py=flr(py)+0.5
 end
 
 local dshipspr=0
 
 if dir>0 then
  px+=dirx[dir]*spd
  py+=diry[dir]*spd
  dshipspr=mysgn(dirx[dir])
 end
  
 shipspr+=mysgn(dshipspr-shipspr)*0.15
 shipspr=mid(-1,shipspr,1)
 
 lastdir=dir
 
 if shotwait>0 then
  shotwait-=1
 end
 
 if btn(❎) then
  if wep==1 then
   shot_raiden()
  elseif wep==2 then
   shot_ddp()
  end
 
 end
 
 doshots()
end

function doshots()
 for s in all(shots) do
  s.x+=s.sx
  s.y+=s.sy
  
  if s.y<-8 then
   del(shots,s)
  end
 end
end

function mysgn(v) 
 return v==0 and 0 or sgn(v)
end
-->8
function shot_raiden()
 if shotwait<=0 and #shots<6 then
  local shotspd=-3.5
  shotwait=4
  
  add(shots,{
   x=px+3,
   y=py,
   sx=0,
   sy=shotspd,
   s=11,
   sh=1
  })
  add(shots,{
   x=px+9,
   y=py,
   sx=0,
   sy=shotspd,
   s=11,
   sh=1
  })
 end
end

function shot_ddp()
 if shotwait<=0 and #shots<100 then
  local shotspd=-7
  shotwait=3
  
  add(shots,{
   x=px,
   y=py,
   sx=0,
   sy=shotspd,
   s=32,
   sh=2
  })
  add(shots,{
   x=px+8,
   y=py,
   sx=0,
   sy=shotspd,
   s=32,
   sh=2
  })
 end
end
__gfx__
00000000000000011000000000000001100000000000000110000000000000011000000000000001100000000990000000070000000700000007000000000000
00000000000000167100000000000016710000000000001661000000000000167100000000000016710000009779000000777000007770000077700000000000
00700700000000111d100000000000111d1000000000011111100000000001d111000000000001d11100000097790000007c7000007c70000077700000000000
00077000000001ccc1100000000001ccc1100000000001cccc1000000000011ccc1000000000011ccc1000009aa9000000070000007c7000007c700000000000
0007700000001c77cc11000000001c77cc11000000001c77ccc10000000011c77cc10000000011c77cc100009aa900000000000000070000007c700000000000
0070070000001c7c1c11000000001c7c1c11000000001c7cc1c10000000011c7c1c10000000011c7c1c100000990000000070000000000000007000000000000
0000000000001c111c11100000011c111c11100000111c1111c11100000111c111c11000000111c111c100000000000000000000000700000007000000000000
0000000000001c111c17100000011c111c17100000171c1111c17100000171c111c11000000171c111c100000000000000000000000000000007000000000000
0000000000011cc17116100000161cc1171610000016117117116100000161711cc16100000161171cc110000000000000000000000000000000000000000000
000000000001d1c711d6d1000016d1c77116d10001d6d117711d6d10001d61177c1d6100001d6d117c1d10000000000000000000000000000000000000000000
00000000001ddd111d6d7d1001dddd1111dd6710176d6d1111d6d6710176dd1111dddd1001d7d6d111ddd1000000000000000000000000000000000000000000
00000000001dd6ddd6d66d1001dd66dddd6d66101666d6dddd6d66610166d6dddd66dd1001d66d6ddd6dd1000000000000000000000000000000000000000000
00000000001d676676d6dd1001d6676676d6dd101dd6d676676d6dd101dd6d6766766d1001dd6d676676d1000000000000000000000000000000000000000000
00000000000176d167d1110000117dd1171111000111171661711110001111711dd7110000111d761d6710000000000000000000000000000000000000000000
000000000000151155d110000001655155d11000000161511516100000011d551556100000011d55115100000000000000000000000000000000000000000000
00000000000001111111000000001111111100000000111111110000000011111111000000001111111000000000000000000000000000000000000000000000
00099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00977900000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00977900009aa9000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09777790009779000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0977779000977900009aa90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
97a77a7909a77a900097790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
97a77a7909a77a900097790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9aa77aa909a77a90009aa90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9aa77aa9099aa990009aa90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9a9aa9a9099aa990009aa90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
999aa999099999900099990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
999aa999099999900099990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90999909099999900099990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90099009090990900009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
